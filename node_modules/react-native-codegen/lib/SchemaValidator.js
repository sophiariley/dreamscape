/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @format
 */
<<<<<<< HEAD
<<<<<<< HEAD

=======
>>>>>>> origin
'use strict';

const nullthrows = require('nullthrows');
function getErrors(schema) {
  const errors = new Set();

  // Map of component name -> Array of module names
  const componentModules = new Map();
  Object.keys(schema.modules).forEach(moduleName => {
    const module = schema.modules[moduleName];
    if (module.components == null) {
      return;
    }
<<<<<<< HEAD
=======
'use strict';

const nullthrows = require('nullthrows');

function getErrors(schema) {
  const errors = new Set(); // Map of component name -> Array of module names

  const componentModules = new Map();
  Object.keys(schema.modules).forEach(moduleName => {
    const module = schema.modules[moduleName];

    if (module.components == null) {
      return;
    }

>>>>>>> origin/Sophia's-branch
=======

>>>>>>> origin
    Object.keys(module.components).forEach(componentName => {
      if (module.components == null) {
        return;
      }
<<<<<<< HEAD
<<<<<<< HEAD
=======

>>>>>>> origin
      if (!componentModules.has(componentName)) {
        componentModules.set(componentName, []);
      }
=======

<<<<<<< HEAD
      if (!componentModules.has(componentName)) {
        componentModules.set(componentName, []);
      }

>>>>>>> origin/Sophia's-branch
=======
>>>>>>> origin
      nullthrows(componentModules.get(componentName)).push(moduleName);
    });
  });
  componentModules.forEach((modules, componentName) => {
    if (modules.length > 1) {
      errors.add(
        `Duplicate components found with name ${componentName}. Found in modules ${modules.join(
          ', ',
        )}`,
      );
    }
  });
  return Array.from(errors).sort();
}
<<<<<<< HEAD
<<<<<<< HEAD
=======

>>>>>>> origin
function validate(schema) {
  const errors = getErrors(schema);
=======

<<<<<<< HEAD
function validate(schema) {
  const errors = getErrors(schema);

>>>>>>> origin/Sophia's-branch
=======
>>>>>>> origin
  if (errors.length !== 0) {
    throw new Error('Errors found validating schema:\n' + errors.join('\n'));
  }
}
<<<<<<< HEAD
<<<<<<< HEAD
=======

>>>>>>> origin/Sophia's-branch
=======

>>>>>>> origin
module.exports = {
  getErrors,
  validate,
};
